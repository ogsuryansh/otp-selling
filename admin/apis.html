<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Management - OTP Bot Platform</title>
    <link rel="stylesheet" href="../assets/css/output.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">

    <script src="../assets/js/app.js"></script>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* Remove underlines from all anchor tags */
        a {
            text-decoration: none;
        }
        
        /* Custom styles for API page */
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#2563eb',
                                secondary: '#1e40af',
                                accent: '#3b82f6'
                            }
                        }
                    }
                }
            }
        });
    </script>
    <style>
        .url-truncate {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        @media (max-width: 768px) {
            .url-truncate {
                max-width: 120px;
            }
        }
        
        .mobile-card {
            display: none;
        }
        
        .desktop-table {
            display: table;
        }
        
        @media (max-width: 768px) {
            .mobile-card {
                display: block;
            }
            
            .desktop-table {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="flex-shrink-0 mr-4 sm:mr-8">
                        <h1 class="text-lg sm:text-xl font-bold text-primary">📱 OTP Bot Platform</h1>
                    </a>
                    <div class="hidden md:block">
                        <div class="ml-6 sm:ml-10 flex items-baseline space-x-2 sm:space-x-4">
                            <a href="/admin/dashboard" class="text-gray-700 hover:text-primary px-2 sm:px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                            <a href="/admin/servers" class="text-gray-700 hover:text-primary px-2 sm:px-3 py-2 rounded-md text-sm font-medium">Servers</a>
                            <a href="/admin/services" class="text-gray-700 hover:text-primary px-2 sm:px-3 py-2 rounded-md text-sm font-medium">Services</a>
                            <a href="/admin/apis" class="bg-primary text-white px-2 sm:px-3 py-2 rounded-md text-sm font-medium">APIs</a>
                            <a href="/admin/orders" class="text-gray-700 hover:text-primary px-2 sm:px-3 py-2 rounded-md text-sm font-medium">Orders</a>
                            <a href="/admin/users" class="text-gray-700 hover:text-primary px-2 sm:px-3 py-2 rounded-md text-sm font-medium">Users</a>
                        </div>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button type="button" class="mobile-menu-button bg-white p-2 rounded-md text-gray-700 hover:text-primary hover:bg-gray-100">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile menu -->
            <div class="mobile-menu md:hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="/admin/dashboard" class="text-gray-700 hover:text-primary block px-3 py-2 rounded-md text-base font-medium">Dashboard</a>
                    <a href="/admin/servers" class="text-gray-700 hover:text-primary block px-3 py-2 rounded-md text-base font-medium">Servers</a>
                    <a href="/admin/services" class="text-gray-700 hover:text-primary block px-3 py-2 rounded-md text-base font-medium">Services</a>
                    <a href="/admin/apis" class="bg-primary text-white block px-3 py-2 rounded-md text-base font-medium">APIs</a>
                    <a href="/admin/orders" class="text-gray-700 hover:text-primary block px-3 py-2 rounded-md text-base font-medium">Orders</a>
                    <a href="/admin/users" class="text-gray-700 hover:text-primary block px-3 py-2 rounded-md text-base font-medium">Users</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
        <!-- Page Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 gap-4">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">API Management</h1>
                <p class="text-gray-600 mt-2">Connect and manage SMS providers for phone numbers and OTP messages</p>
            </div>
            <button onclick="openAddApiModal()" class="btn btn-primary">
                <span>🔌</span>
                Connect API
            </button>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8">
            <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                            <span class="text-white text-sm">🔌</span>
                        </div>
                    </div>
                    <div class="ml-4 flex-1">
                        <p class="text-sm font-medium text-gray-500">Total APIs</p>
                        <p class="text-lg sm:text-xl font-semibold text-gray-900" id="totalApis">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                            <span class="text-white text-sm">🟢</span>
                        </div>
                    </div>
                    <div class="ml-4 flex-1">
                        <p class="text-sm font-medium text-gray-500">Active APIs</p>
                        <p class="text-lg sm:text-xl font-semibold text-gray-900" id="activeApis">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center">
                            <span class="text-white text-sm">🔴</span>
                        </div>
                    </div>
                    <div class="ml-4 flex-1">
                        <p class="text-sm font-medium text-gray-500">Inactive APIs</p>
                        <p class="text-lg sm:text-xl font-semibold text-gray-900" id="inactiveApis">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-yellow-500 rounded-lg flex items-center justify-center">
                            <span class="text-white text-sm">💰</span>
                        </div>
                    </div>
                    <div class="ml-4 flex-1">
                        <p class="text-sm font-medium text-gray-500">Total Balance</p>
                        <p class="text-lg sm:text-xl font-semibold text-gray-900" id="totalBalance">₹0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Table View -->
        <div class="bg-white rounded-lg shadow desktop-table">
            <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Connected APIs</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Provider</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">API Key</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Balance</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Get Number URL</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="apisTable">
                        <tr>
                            <td colspan="6" class="px-3 sm:px-6 py-4 text-center text-gray-500">
                                No APIs connected. Click "Connect API" to add your first API provider.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mobile Card View -->
        <div class="mobile-card space-y-4" id="mobileApisList">
            <!-- Mobile cards will be populated here -->
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-lg shadow mt-6 sm:mt-8">
            <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Quick Actions</h3>
            </div>
            <div class="p-4 sm:p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button onclick="openAddApiModal()" class="flex items-center p-4 bg-green-50 hover:bg-green-100 rounded-lg border border-green-200 transition-colors w-full text-left">
                        <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">🔌</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">Connect API</h4>
                            <p class="text-sm text-gray-600">Connect new OTP provider</p>
                        </div>
                    </button>
                    
                    <a href="/admin/servers" class="flex items-center p-4 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 transition-colors">
                        <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">🖥️</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">Manage Servers</h4>
                            <p class="text-sm text-gray-600">Add/edit server configurations</p>
                        </div>
                    </a>
                    
                    <a href="/admin/services" class="flex items-center p-4 bg-purple-50 hover:bg-purple-100 rounded-lg border border-purple-200 transition-colors">
                        <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">🔧</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">Manage Services</h4>
                            <p class="text-sm text-gray-600">Configure OTP services</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Add/Edit API Modal -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Connect an OTP API</h3>
                <button onclick="closeApiModal()" class="modal-close">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Description -->
                <p class="text-gray-600 mb-6">Choose a server and add an SMS/OTP API to all the services available in that server.</p>
                
                <!-- Enhanced Form -->
                <form id="apiForm" class="space-y-4">
                    <input type="hidden" id="apiId" name="apiId">
                    
                    <div class="form-group">
                        <label for="serverId" class="form-label">Select Server</label>
                        <select id="serverId" name="serverId" required class="form-select">
                            <option value="">Select Server</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="name" class="form-label">API Name *</label>
                        <input type="text" id="name" name="name" required class="form-input" placeholder="My Api">
                    </div>
                    
                    <div class="form-group">
                        <label for="authHeaders" class="form-label">
                            <input type="checkbox" id="authHeaders" name="authHeaders" class="mr-2">
                            Does your API uses Authorization Headers?
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="responseType" class="form-label">API response type</label>
                        <select id="responseType" name="responseType" class="form-select">
                            <option value="text">Text</option>
                            <option value="json">JSON</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="getNumberUrl" class="form-label">API Get Number URL *</label>
                        <input type="url" id="getNumberUrl" name="getNumberUrl" required class="form-input" placeholder="https://api.myservice.com/handler?a">
                    </div>
                    
                    <div class="form-group">
                        <label for="getMessageUrl" class="form-label">API Get Message/Status URL *</label>
                        <input type="url" id="getMessageUrl" name="getMessageUrl" required class="form-input" placeholder="https://api.myservice.com/handler?a">
                    </div>
                    
                    <div class="form-group">
                        <div class="bg-gray-100 p-3 rounded-lg mb-3">
                            <p class="text-sm text-gray-700 mb-2">
                                How to know that get status url has sent is a success message indicating user has received his otp. Also what is the path to message text if response type is json. ⓘ
                            </p>
                            <input type="text" id="responseStartsWith" name="responseStartsWith" required class="form-input" placeholder="STATUS_SUCCESS">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="activateNextUrl" class="form-label">API Activate Next Message URL</label>
                        <input type="url" id="activateNextUrl" name="activateNextUrl" class="form-input" placeholder="https://api.myservice.com/handler?a">
                    </div>
                    
                    <div class="form-group">
                        <label for="cancelNumberUrl" class="form-label">API Cancel Number URL *</label>
                        <input type="url" id="cancelNumberUrl" name="cancelNumberUrl" required class="form-input" placeholder="https://api.myservice.com/handler?a">
                    </div>
                    
                    <div class="form-group">
                        <label for="autoCancelMinutes" class="form-label">API AutoCancel Number in Minutes *</label>
                        <input type="number" id="autoCancelMinutes" name="autoCancelMinutes" required min="0" class="form-input" placeholder="5">
                    </div>
                    
                    <div class="form-group">
                        <label for="retryTimes" class="form-label">API Retry Get Number URL _ times *</label>
                        <input type="number" id="retryTimes" name="retryTimes" required min="0" class="form-input" placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Your Selected Server will include following services:</label>
                        <div class="bg-white p-3 rounded-lg border">
                            <span id="selectedServerServices">No services available</span>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" onclick="closeApiModal()" class="btn btn-secondary">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <span id="submitBtnText">Submit</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        const mobileMenuButton = document.querySelector('.mobile-menu-button');
        const mobileMenu = document.querySelector('.mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Enhanced API modal functions
        function openAddApiModal() {
            document.getElementById('modalTitle').textContent = 'Connect an OTP API';
            document.getElementById('submitBtnText').textContent = 'Submit';
            document.getElementById('apiForm').reset();
            document.getElementById('apiId').value = '';
            showModal('apiModal');
            loadServersForDropdown();
        }

        function closeApiModal() {
            hideModal('apiModal');
            // Reset form when closing
            document.getElementById('apiForm').reset();
        }

        function editApi(id) {
            document.getElementById('modalTitle').textContent = 'Edit API';
            document.getElementById('submitBtnText').textContent = 'Submit';
            document.getElementById('apiForm').reset();
            document.getElementById('apiId').value = id || '';
            
            if (id) {
                // Load API data for editing
                loadApiForEditing(id);
            }
            
            showModal('apiModal');
            loadServersForDropdown();
        }

        async function loadServersForDropdown() {
            try {
                const response = await fetch('/api/servers');
                if (response.ok) {
                    const data = await response.json();
                    const servers = data.data || data;
                    
                    const serverSelect = document.getElementById('serverId');
                    serverSelect.innerHTML = '<option value="">Select Server</option>';
                    
                    if (Array.isArray(servers)) {
                        servers.forEach(server => {
                            const option = document.createElement('option');
                            option.value = server.id || server._id;
                            option.textContent = `${server.serverName || server.name} (${server.countryName || server.countryCode})`;
                            serverSelect.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading servers for dropdown:', error);
            }
        }

        async function loadApiForEditing(id) {
            try {
                const response = await fetch(`/api/apis/${id}`);
                if (response.ok) {
                    const apiData = await response.json();
                    const api = apiData.data || apiData;
                    
                    document.getElementById('name').value = api.name || '';
                    document.getElementById('getNumberUrl').value = api.getNumberUrl || '';
                    document.getElementById('getMessageUrl').value = api.getMessageUrl || '';
                    document.getElementById('cancelNumberUrl').value = api.cancelNumberUrl || '';
                    document.getElementById('activateNextUrl').value = api.activateNextUrl || '';
                    document.getElementById('autoCancelMinutes').value = api.autoCancelMinutes || '';
                    document.getElementById('retryTimes').value = api.retryTimes || '';
                    document.getElementById('responseStartsWith').value = api.responseStartsWith || '';
                    document.getElementById('responseType').value = api.responseType || 'text';
                    document.getElementById('authHeaders').checked = api.authHeaders || false;
                } else {
                    console.error('Failed to load API data');
                    alert('Failed to load API data for editing');
                }
            } catch (error) {
                console.error('Error loading API for editing:', error);
                alert('Error loading API data. Please try again.');
            }
        }

        async function deleteApi(apiId) {
            if (confirm('Are you sure you want to delete this API?')) {
                try {
                    const response = await fetch(`/api/apis/${apiId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadApis(); // Reload the APIs list
                        alert('API deleted successfully');
                    } else {
                        const errorData = await response.json();
                        const error = errorData.data || errorData;
                        alert('Error: ' + (error.message || 'Failed to delete API'));
                    }
                } catch (error) {
                    console.error('Error deleting API:', error);
                    alert('Error deleting API. Please try again.');
                }
            }
        }

        async function testApi(apiId) {
            try {
                alert('Testing API functionality...');
                // Add actual API testing logic here
            } catch (error) {
                console.error('Error testing API:', error);
                alert('Error testing API. Please try again.');
            }
        }

        // Handle form submission
        document.getElementById('apiForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const apiId = formData.get('apiId');
            const apiData = {
                name: formData.get('name'),
                serverId: formData.get('serverId'),
                authHeaders: formData.get('authHeaders') === 'on',
                responseType: formData.get('responseType'),
                getNumberUrl: formData.get('getNumberUrl'),
                getMessageUrl: formData.get('getMessageUrl'),
                responseStartsWith: formData.get('responseStartsWith'),
                activateNextUrl: formData.get('activateNextUrl'),
                cancelNumberUrl: formData.get('cancelNumberUrl'),
                autoCancelMinutes: parseInt(formData.get('autoCancelMinutes')) || 5,
                retryTimes: parseInt(formData.get('retryTimes')) || 0,
                status: 'active'
            };
            
            try {
                let response;
                if (apiId) {
                    // Update existing API
                    response = await fetch(`/api/apis/${apiId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(apiData)
                    });
                } else {
                    // Create new API
                    response = await fetch('/api/apis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(apiData)
                    });
                }
                
                if (response.ok) {
                    closeApiModal();
                    loadApis(); // Reload the APIs list
                    alert(apiId ? 'API updated successfully' : 'API created successfully');
                } else {
                    const errorData = await response.json();
                    const error = errorData.data || errorData;
                    alert('Error: ' + (error.message || 'Failed to save API'));
                }
            } catch (error) {
                console.error('Error saving API:', error);
                alert('Error saving API. Please try again.');
            }
        });

        // Load APIs data
        document.addEventListener('DOMContentLoaded', function() {
            loadApis();
        });

        async function loadApis() {
            try {
                const response = await fetch('/api/apis');
                if (response.ok) {
                    const data = await response.json();
                    const apis = data.data || data;
                    
                    if (!Array.isArray(apis)) {
                        console.error('APIs response is not an array:', apis);
                        updateApisList([]);
                        return;
                    }
                    
                    updateApisList(apis);
                    updateStats(apis);
                } else {
                    console.error('Failed to load APIs:', response.status);
                    updateApisList([]);
                }
            } catch (error) {
                console.error('APIs loading failed:', error);
                updateApisList([]);
            }
        }

        function updateStats(apis) {
            const totalApis = apis.length;
            const activeApis = apis.filter(api => api.status === 'active').length;
            const inactiveApis = apis.filter(api => api.status === 'inactive').length;
            const totalBalance = apis.reduce((sum, api) => sum + (parseFloat(api.balance) || 0), 0);
            
            document.getElementById('totalApis').textContent = totalApis;
            document.getElementById('activeApis').textContent = activeApis;
            document.getElementById('inactiveApis').textContent = inactiveApis;
            document.getElementById('totalBalance').textContent = `₹${totalBalance.toFixed(2)}`;
        }

        function updateApisList(apis) {
            const tbody = document.getElementById('apisTable');
            const mobileList = document.getElementById('mobileApisList');
            
            if (!apis || apis.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-3 sm:px-6 py-4 text-center text-gray-500">No APIs connected. Click "Connect API" to add your first API provider.</td></tr>';
                mobileList.innerHTML = '<div class="text-center text-gray-500 py-8">No APIs connected. Click "Connect API" to add your first API provider.</div>';
                return;
            }
            
            // Desktop table view
            tbody.innerHTML = apis.map(api => `
                <tr>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">🔌</span>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${api.name || api.providerName || 'Unknown'}</div>
                                <div class="text-sm text-gray-500 url-truncate" title="${api.url || api.providerUrl || 'N/A'}">${api.url || api.providerUrl || 'N/A'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            api.status === 'active' ? 'bg-green-100 text-green-800' : 
                            api.status === 'inactive' ? 'bg-red-100 text-red-800' : 
                            'bg-yellow-100 text-yellow-800'
                        }">
                            ${api.status || 'unknown'}
                        </span>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-500">${api.apiKey ? '***' + api.apiKey.slice(-4) : 'N/A'}</td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${api.balance || 0}</td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div class="url-truncate" title="${api.getNumberUrl || api.getNumbersUrl || 'N/A'}">${api.getNumberUrl || api.getNumbersUrl || 'N/A'}</div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="btn-group">
                            <button onclick="testApi('${api._id || api.id}')" class="action-btn action-btn-edit">
                                <span>🧪</span>
                                Test
                            </button>
                            <button onclick="editApi('${api._id || api.id}')" class="action-btn action-btn-edit">
                                <span>✏️</span>
                                Edit
                            </button>
                            <button onclick="deleteApi('${api._id || api.id}')" class="action-btn action-btn-delete">
                                <span>🗑️</span>
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Mobile card view
            mobileList.innerHTML = apis.map(api => `
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">🔌</span>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${api.name || api.providerName || 'Unknown'}</div>
                                <div class="text-xs text-gray-500">${api.type || 'Unknown Type'}</div>
                            </div>
                        </div>
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            api.status === 'active' ? 'bg-green-100 text-green-800' : 
                            api.status === 'inactive' ? 'bg-red-100 text-red-800' : 
                            'bg-yellow-100 text-yellow-800'
                        }">
                            ${api.status || 'unknown'}
                        </span>
                    </div>
                    
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-500">API Key:</span>
                            <span class="text-gray-900">${api.apiKey ? '***' + api.apiKey.slice(-4) : 'N/A'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Balance:</span>
                            <span class="text-gray-900">₹${api.balance || 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">URL:</span>
                            <span class="text-gray-900 url-truncate" title="${api.url || api.providerUrl || 'N/A'}">${api.url || api.providerUrl || 'N/A'}</span>
                        </div>
                    </div>
                    
                    <div class="btn-group mt-4 pt-3 border-t border-gray-200">
                        <button onclick="testApi('${api._id || api.id}')" class="action-btn action-btn-edit">
                            <span>🧪</span>
                            Test
                        </button>
                        <button onclick="editApi('${api._id || api.id}')" class="action-btn action-btn-edit">
                            <span>✏️</span>
                            Edit
                        </button>
                        <button onclick="deleteApi('${api._id || api.id}')" class="action-btn action-btn-delete">
                            <span>🗑️</span>
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('apiModal');
            if (event.target === modal) {
                closeApiModal();
            }
        }
    </script>
</body>
</html>
